---
version: "3.8"
services:
  jore4-hasura:
    image: "hsldevcom/jore4-hasura:main--10254a33107fb72ee5fd2b78d4b76000d8626203"
  importer:
    container_name: importer
    build:
      context: ../
      dockerfile: ./Dockerfile
    restart: "unless-stopped"
    environment:
      - SOURCE_DB_HOSTNAME=mssqltestdb
      - SOURCE_DB_PORT=1433
      - SOURCE_DB_DATABASE=jore3testdb
      - SOURCE_DB_USERNAME=sa
      - SOURCE_DB_PASSWORD=P@ssw0rd
      - IMPORTER_DB_URL=jdbc:postgresql://importer-jooq-database:5432/devdb?stringtype=unspecified
      - IMPORTER_DB_USERNAME=devdb
      - IMPORTER_DB_PASSWORD=devdb
      - JORE_IMPORTER_MIGRATE=true
    networks:
      - jore4
    ports:
      - "127.0.0.1:3200:8080"

  importer-jooq-database:
    image: postgis/postgis:12-3.1-alpine
    container_name: importer-database
    restart: "unless-stopped"
    environment:
      - POSTGRES_DB=devdb
      - POSTGRES_USER=devdb
      - POSTGRES_PASSWORD=devdb
    ports:
      - "127.0.0.1:16000:5432"
    networks:
      - jore4

  importer-test-database:
    image: postgis/postgis:12-3.1-alpine
    container_name: importer-test-database
    environment:
      - POSTGRES_DB=importertestdatabase
      - POSTGRES_USER=importertestdatabase
      - POSTGRES_PASSWORD=importertestdatabase
    ports:
      - "127.0.0.1:17000:5432"
    networks:
      - jore4

  jore4-mssqltestdb:
    container_name: "mssqltestdb"
    image: "hsldevcom/jore4-mssql-testdb:schema-only-main--a650cec4970a6c78335e50a24223e7baa0916dc4"
    restart: "unless-stopped"
    networks:
      - jore4
    environment:
      SA_PASSWORD: "P@ssw0rd"
    ports:
      - "127.0.0.1:1433:1433"
networks:
    jore4:

